<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="analytics.js" type="module"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë„ìë£Œ ê´€ë¦¬ - GOGWAN</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="page-header">
            <button class="back-button" onclick="location.href='index.html'">â†</button>
            <h1 class="page-title">ë³´ë„ìë£Œ ê´€ë¦¬</h1>
            <div style="width: 40px;"></div>
        </div>

        <!-- ê²€ìƒ‰ë°” -->
        <div class="search-bar">
            <input
                type="text"
                class="search-input"
                id="searchInput"
                placeholder="ì œëª©, ë‚´ìš©, ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰..."
            >
        </div>

        <!-- ë³´ë„ìë£Œ ëª©ë¡ -->
        <div class="release-list" id="releaseList">
            <div style="text-align: center; padding: 40px; color: #6B7280;">
                ë¡œë”© ì¤‘...
            </div>
        </div>

        <!-- FAB ë²„íŠ¼ -->
        <button class="fab" onclick="location.href='create.html'">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                <path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
            </svg>
            AIë¡œ ì‘ì„±í•˜ê¸°
        </button>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyD-i5QR-MFeCLQtSMlIqXUhVuIzkJQBRhA",
            authDomain: "gogwan-e79bc.firebaseapp.com",
            projectId: "gogwan-e79bc",
            storageBucket: "gogwan-e79bc.firebasestorage.app",
            messagingSenderId: "241129624672",
            appId: "1:241129624672:web:920301c7f196322c761f05"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allReleases = [];

        // ë³´ë„ìë£Œ ëª©ë¡ ë¡œë“œ
        async function loadReleases() {
            const releaseList = document.getElementById('releaseList');
            releaseList.innerHTML = '<div style="text-align: center; padding: 40px; color: #6B7280;">ë¡œë”© ì¤‘...</div>';

            try {
                const q = query(collection(db, 'press_releases'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    releaseList.innerHTML = `
                        <div style="text-align: center; padding: 60px;">
                            <div style="width: 80px; height: 80px; background: #F3F4F6; border-radius: 40px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="#9CA3AF">
                                    <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2M18 20H6V4H13V9H18V20Z"/>
                                </svg>
                            </div>
                            <div style="font-size: 1.125em; font-weight: 600; color: #111827; margin-bottom: 8px;">ë³´ë„ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤</div>
                            <div style="font-size: 0.875em; color: #6B7280;">AIë¡œ ìƒˆ ë³´ë„ìë£Œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”</div>
                        </div>
                    `;
                    return;
                }

                allReleases = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                renderReleases(allReleases);
            } catch (error) {
                console.error('Error loading releases:', error);
                releaseList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #EF4444;">
                        âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤
                    </div>
                `;
            }
        }

        // ë³´ë„ìë£Œ ë Œë”ë§
        function renderReleases(releases) {
            const releaseList = document.getElementById('releaseList');

            if (releases.length === 0) {
                releaseList.innerHTML = `
                    <div style="text-align: center; padding: 60px;">
                        <div style="font-size: 1.125em; font-weight: 600; color: #111827; margin-bottom: 8px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div style="font-size: 0.875em; color: #6B7280;">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”</div>
                    </div>
                `;
                return;
            }

            releaseList.innerHTML = releases.map(release => {
                const date = release.createdAt?.toDate ? release.createdAt.toDate() : new Date();
                const dateStr = date.toLocaleDateString('ko-KR');

                return `
                    <div class="release-item" onclick="location.href='detail.html?id=${release.id}'">
                        <div class="release-meta">
                            <span class="category-badge ${release.category}">${release.category}</span>
                            ${release.isAiGenerated ? `
                                <span class="ai-badge">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/>
                                    </svg>
                                    AI
                                </span>
                            ` : ''}
                        </div>
                        <div class="release-title">${release.title}</div>
                        <div class="release-subtitle">${release.subtitle}</div>
                        <div class="release-info">
                            <span>ğŸ“… ${dateStr}</span>
                            <span>ğŸ‘¤ ${release.authorName}</span>
                            <span>ğŸ‘ï¸ ${release.views || 0}íšŒ</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ê²€ìƒ‰
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();

            if (!query) {
                renderReleases(allReleases);
                return;
            }

            const filtered = allReleases.filter(release =>
                release.title.toLowerCase().includes(query) ||
                release.content.toLowerCase().includes(query) ||
                release.category.toLowerCase().includes(query)
            );

            renderReleases(filtered);
        });

        // ì´ˆê¸° ë¡œë“œ
        loadReleases();
    </script>
</body>
</html>
