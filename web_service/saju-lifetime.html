<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="analytics.js" type="module"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ìƒìš´ - GOGWAN</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="page-header">
            <button class="back-button" onclick="history.back()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z"/>
                </svg>
            </button>
            <h1 class="page-title">í‰ìƒìš´</h1>
            <div style="width: 40px;"></div>
        </div>

        <!-- ì†Œê°œ ì¹´ë“œ -->
        <div class="input-card" style="background: linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%); color: white; border: none;">
            <div style="text-align: center;">
                <div style="font-size: 2em; margin-bottom: 8px;">ğŸ”®</div>
                <h2 style="font-size: 1.25em; font-weight: 700; margin-bottom: 8px;">ì‚¬ì£¼íŒ”ìë¡œ ë³´ëŠ” í‰ìƒìš´</h2>
                <p style="font-size: 0.875em; opacity: 0.9;">ìƒë…„ì›”ì¼ì‹œë¥¼ ì…ë ¥í•˜ì‹œë©´ ì‚¬ì£¼íŒ”ìë¥¼ ë¶„ì„í•˜ì—¬<br>í‰ìƒì˜ ìš´ì„¸ë¥¼ ìì„¸íˆ í’€ì´í•´ë“œë¦½ë‹ˆë‹¤</p>
            </div>
        </div>

        <!-- ìƒë…„ì›”ì¼ ì…ë ¥ -->
        <div class="input-card">
            <div class="input-label">ìƒë…„ì›”ì¼ <span class="required">*</span></div>
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 8px;">
                <select id="birthYear" style="width: 100%; padding: 12px 16px; border: none; background: #F9FAFB; border-radius: 8px; font-size: 1em; font-family: inherit;">
                    <option value="">ë…„ë„ ì„ íƒ</option>
                </select>
                <select id="birthMonth" style="width: 100%; padding: 12px 16px; border: none; background: #F9FAFB; border-radius: 8px; font-size: 1em; font-family: inherit;">
                    <option value="">ì›”</option>
                    <option value="1">1ì›”</option>
                    <option value="2">2ì›”</option>
                    <option value="3">3ì›”</option>
                    <option value="4">4ì›”</option>
                    <option value="5">5ì›”</option>
                    <option value="6">6ì›”</option>
                    <option value="7">7ì›”</option>
                    <option value="8">8ì›”</option>
                    <option value="9">9ì›”</option>
                    <option value="10">10ì›”</option>
                    <option value="11">11ì›”</option>
                    <option value="12">12ì›”</option>
                </select>
                <select id="birthDay" style="width: 100%; padding: 12px 16px; border: none; background: #F9FAFB; border-radius: 8px; font-size: 1em; font-family: inherit;">
                    <option value="">ì¼</option>
                </select>
            </div>
        </div>

        <!-- ì‹œê°„ ì…ë ¥ -->
        <div class="input-card">
            <div class="input-label">íƒœì–´ë‚œ ì‹œê°„ <span class="required">*</span></div>
            <select id="birthHour" style="width: 100%; padding: 12px 16px; border: none; background: #F9FAFB; border-radius: 8px; font-size: 1em; font-family: inherit;">
                <option value="">ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="0">ìì‹œ (23:30 - 01:29)</option>
                <option value="1">ì¶•ì‹œ (01:30 - 03:29)</option>
                <option value="2">ì¸ì‹œ (03:30 - 05:29)</option>
                <option value="3">ë¬˜ì‹œ (05:30 - 07:29)</option>
                <option value="4">ì§„ì‹œ (07:30 - 09:29)</option>
                <option value="5">ì‚¬ì‹œ (09:30 - 11:29)</option>
                <option value="6">ì˜¤ì‹œ (11:30 - 13:29)</option>
                <option value="7">ë¯¸ì‹œ (13:30 - 15:29)</option>
                <option value="8">ì‹ ì‹œ (15:30 - 17:29)</option>
                <option value="9">ìœ ì‹œ (17:30 - 19:29)</option>
                <option value="10">ìˆ ì‹œ (19:30 - 21:29)</option>
                <option value="11">í•´ì‹œ (21:30 - 23:29)</option>
            </select>
            <div class="input-hint">ì •í™•í•œ ì‹œê°„ì„ ëª¨ë¥´ì‹œë©´ ëŒ€ëµì ì¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
        </div>

        <!-- ì„±ë³„ ì„ íƒ -->
        <div class="input-card">
            <div class="input-label">ì„±ë³„ <span class="required">*</span></div>
            <div class="category-chips">
                <div class="category-chip selected" data-gender="male">ë‚¨ì„±</div>
                <div class="category-chip" data-gender="female">ì—¬ì„±</div>
            </div>
        </div>

        <!-- ì–‘ë ¥/ìŒë ¥ ì„ íƒ -->
        <div class="input-card">
            <div class="input-label">ì–‘ë ¥/ìŒë ¥ <span class="required">*</span></div>
            <div class="category-chips">
                <div class="category-chip selected" data-calendar="solar">ì–‘ë ¥</div>
                <div class="category-chip" data-calendar="lunar">ìŒë ¥</div>
            </div>
            <div class="input-hint">ìƒë…„ì›”ì¼ì´ ì–‘ë ¥ì¸ì§€ ìŒë ¥ì¸ì§€ ì„ íƒí•´ì£¼ì„¸ìš”</div>
        </div>

        <!-- ìƒì„± ë²„íŠ¼ -->
        <button class="generate-button" id="generateButton">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                <path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/>
            </svg>
            í‰ìƒìš´ ë³´ê¸°
        </button>

        <!-- ì‚¬ì£¼íŒ”ì ì¹´ë“œ -->
        <div class="result-card" id="sajuCard" style="display: none;">
            <div class="result-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#8B5CF6">
                    <path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/>
                </svg>
                <span style="font-size: 1.125em; font-weight: 600; color: #111827;">ì‚¬ì£¼íŒ”ì</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 16px; background: #F9FAFB; border-radius: 8px;">
                <div style="text-align: center;">
                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">ë…„ì£¼</div>
                    <div id="yearPillar" style="font-size: 1.25em; font-weight: 700; color: #111827;"></div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">ì›”ì£¼</div>
                    <div id="monthPillar" style="font-size: 1.25em; font-weight: 700; color: #111827;"></div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">ì¼ì£¼</div>
                    <div id="dayPillar" style="font-size: 1.25em; font-weight: 700; color: #111827;"></div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">ì‹œì£¼</div>
                    <div id="hourPillar" style="font-size: 1.25em; font-weight: 700; color: #111827;"></div>
                </div>
            </div>
        </div>

        <!-- í‰ìƒìš´ í•´ì„ -->
        <div class="result-card" id="resultCard" style="display: none;">
            <div class="result-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#8B5CF6">
                    <path d="M12 3C7.03 3 3 7.03 3 12S7.03 21 12 21 21 16.97 21 12 16.97 3 12 3M12 19C8.13 19 5 15.87 5 12S8.13 5 12 5 19 8.13 19 12 15.87 19 12 19M12.5 8H11V14L15.75 16.85L16.5 15.62L12.5 13.25V8Z"/>
                </svg>
                <span style="font-size: 1.125em; font-weight: 600; color: #111827;">í‰ìƒìš´ í•´ì„</span>
            </div>
            <div class="result-content" id="resultContent" style="line-height: 1.8;"></div>
        </div>
    </div>

    <script>
        let selectedGender = 'male';
        let selectedCalendar = 'solar';
        let currentYear = new Date().getFullYear();

        // ìƒë…„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” (1940ë…„ë¶€í„° í˜„ì¬ ì—°ë„ê¹Œì§€)
        const birthYearSelect = document.getElementById('birthYear');
        for (let year = currentYear; year >= 1940; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + 'ë…„';
            birthYearSelect.appendChild(option);
        }
        // ê¸°ë³¸ê°’: 33ì‚´ (1992ë…„)
        birthYearSelect.value = 1992;

        // ì¼ì ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDayOptions() {
            const month = parseInt(document.getElementById('birthMonth').value);
            const year = parseInt(document.getElementById('birthYear').value);
            const daySelect = document.getElementById('birthDay');

            if (!month) {
                daySelect.innerHTML = '<option value="">ì¼</option>';
                return;
            }

            // í•´ë‹¹ ì›”ì˜ ì¼ìˆ˜ ê³„ì‚°
            const daysInMonth = new Date(year || 2000, month, 0).getDate();

            const currentDay = daySelect.value;
            daySelect.innerHTML = '<option value="">ì¼</option>';

            for (let day = 1; day <= daysInMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day + 'ì¼';
                daySelect.appendChild(option);
            }

            // ì´ì „ ì„ íƒê°’ ë³µì› (ê°€ëŠ¥í•œ ê²½ìš°)
            if (currentDay && parseInt(currentDay) <= daysInMonth) {
                daySelect.value = currentDay;
            }
        }

        // ì›”/ë…„ ë³€ê²½ì‹œ ì¼ì ì—…ë°ì´íŠ¸
        document.getElementById('birthMonth').addEventListener('change', updateDayOptions);
        document.getElementById('birthYear').addEventListener('change', updateDayOptions);

        // ì„±ë³„ ì„ íƒ
        document.querySelectorAll('[data-gender]').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('[data-gender]').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
                selectedGender = chip.dataset.gender;
            });
        });

        // ì–‘ë ¥/ìŒë ¥ ì„ íƒ
        document.querySelectorAll('[data-calendar]').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('[data-calendar]').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
                selectedCalendar = chip.dataset.calendar;
            });
        });

        // í‰ìƒìš´ ìƒì„±
        document.getElementById('generateButton').addEventListener('click', async () => {
            const birthYear = parseInt(document.getElementById('birthYear').value);
            const birthMonth = parseInt(document.getElementById('birthMonth').value);
            const birthDay = parseInt(document.getElementById('birthDay').value);
            const birthHour = document.getElementById('birthHour').value;

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!birthYear || !birthMonth || !birthDay) {
                alert('ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (!birthHour) {
                alert('íƒœì–´ë‚œ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }

            if (birthYear < 1900 || birthYear > 2100) {
                alert('ì˜¬ë°”ë¥¸ ì—°ë„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (1900-2100)');
                return;
            }

            if (birthMonth < 1 || birthMonth > 12) {
                alert('ì˜¬ë°”ë¥¸ ì›”ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (1-12)');
                return;
            }

            if (birthDay < 1 || birthDay > 31) {
                alert('ì˜¬ë°”ë¥¸ ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (1-31)');
                return;
            }

            const button = document.getElementById('generateButton');
            button.disabled = true;
            button.innerHTML = `
                <div class="spinner"></div>
                í‰ìƒìš´ ë¶„ì„ ì¤‘...
            `;

            try {
                const response = await fetch('https://gogwan-backend-818506848351.asia-northeast3.run.app/api/saju-lifetime', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        birth_year: birthYear,
                        birth_month: birthMonth,
                        birth_day: birthDay,
                        birth_hour: parseInt(birthHour),
                        gender: selectedGender,
                        is_lunar: selectedCalendar === 'lunar'
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message || 'ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                // ì‚¬ì£¼íŒ”ì í‘œì‹œ
                document.getElementById('yearPillar').textContent = data.saju.year_pillar;
                document.getElementById('monthPillar').textContent = data.saju.month_pillar;
                document.getElementById('dayPillar').textContent = data.saju.day_pillar;
                document.getElementById('hourPillar').textContent = data.saju.hour_pillar;
                document.getElementById('sajuCard').style.display = 'block';

                // í‰ìƒìš´ í•´ì„ í‘œì‹œ
                document.getElementById('resultContent').textContent = data.interpretation;
                document.getElementById('resultCard').style.display = 'block';

                // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
                document.getElementById('sajuCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                alert('ë¶„ì„ ì‹¤íŒ¨: ' + error.message);
                console.error(error);
            } finally {
                button.disabled = false;
                button.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/>
                    </svg>
                    í‰ìƒìš´ ë³´ê¸°
                `;
            }
        });
    </script>
</body>
</html>
