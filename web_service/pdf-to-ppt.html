<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="analytics.js" type="module"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF â†’ PPT ë³€í™˜ - GOGWAN</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .file-upload-area {
            background: white;
            border: 3px dashed #3B82F6;
            border-radius: 16px;
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }

        .file-upload-area:hover {
            background: #EFF6FF;
            border-color: #2563EB;
        }

        .file-upload-area.active {
            background: #DBEAFE;
            border-color: #1D4ED8;
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-info {
            display: none;
            background: #F0FDF4;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            align-items: center;
            gap: 12px;
        }

        .file-info.show {
            display: flex;
        }

        .file-icon {
            width: 48px;
            height: 48px;
            background: #10B981;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-details {
            flex: 1;
            text-align: left;
        }

        .file-name {
            font-weight: 600;
            color: #065F46;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 0.875em;
            color: #059669;
        }

        .result-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            display: none;
        }

        .result-card.show {
            display: block;
        }

        .result-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-badge {
            flex: 1;
            background: #F0F9FF;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: 700;
            color: #0369A1;
        }

        .stat-label {
            font-size: 0.875em;
            color: #0284C7;
            margin-top: 4px;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .download-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="page-header">
            <button class="back-button" onclick="history.back()">â†</button>
            <h1 class="page-title">ğŸ“„ PDF â†’ PPT ë³€í™˜</h1>
            <div style="width: 40px;"></div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="file-upload-area" id="uploadArea">
            <div class="upload-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                </svg>
            </div>
            <h3 style="color: #1E3A8A; margin-bottom: 8px;">PDF íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <p style="color: #6B7280; margin-bottom: 16px;">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <input type="file" id="pdfInput" accept=".pdf" style="display: none;">
            <button class="category-chip selected" onclick="document.getElementById('pdfInput').click()">
                íŒŒì¼ ì„ íƒ
            </button>

            <div class="file-info" id="fileInfo">
                <div class="file-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2M18 20H6V4H13V9H18V20Z"/>
                    </svg>
                </div>
                <div class="file-details">
                    <div class="file-name" id="fileName"></div>
                    <div class="file-size" id="fileSize"></div>
                </div>
            </div>
        </div>

        <!-- ë³€í™˜ ë²„íŠ¼ -->
        <button class="generate-button" id="convertButton" style="display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>
            </svg>
            PPTë¡œ ë³€í™˜í•˜ê¸°
        </button>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div class="result-card" id="resultCard">
            <h3 style="color: #1E3A8A; margin-bottom: 16px;">âœ… ë³€í™˜ ì™„ë£Œ</h3>

            <div class="result-stats">
                <div class="stat-badge">
                    <div class="stat-number" id="slideCount">0</div>
                    <div class="stat-label">ìŠ¬ë¼ì´ë“œ</div>
                </div>
                <div class="stat-badge">
                    <div class="stat-number">PPT</div>
                    <div class="stat-label">íŒŒì¼ í˜•ì‹</div>
                </div>
            </div>

            <button class="download-button" onclick="downloadPPT()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>
                </svg>
                PowerPoint íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            </button>
        </div>

    </div>

    <script>
        let selectedFile = null;
        let pptData = null;
        let pptFilename = '';

        const uploadArea = document.getElementById('uploadArea');
        const pdfInput = document.getElementById('pdfInput');
        const fileInfo = document.getElementById('fileInfo');
        const convertButton = document.getElementById('convertButton');
        const resultCard = document.getElementById('resultCard');

        // ì—…ë¡œë“œ ì˜ì—­ í´ë¦­
        uploadArea.addEventListener('click', (e) => {
            if (e.target === uploadArea || e.target.closest('.upload-icon')) {
                pdfInput.click();
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('active');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('active');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('active');

            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                handleFile(files[0]);
            }
        });

        // íŒŒì¼ ì„ íƒ
        pdfInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // íŒŒì¼ ì²˜ë¦¬
        function handleFile(file) {
            selectedFile = file;

            // íŒŒì¼ ì •ë³´ í‘œì‹œ
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            fileInfo.classList.add('show');
            convertButton.style.display = 'block';
            resultCard.classList.remove('show');
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // PPT ë³€í™˜
        document.getElementById('convertButton').addEventListener('click', async () => {
            if (!selectedFile) {
                alert('PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const button = document.getElementById('convertButton');
            const originalHTML = button.innerHTML;

            button.innerHTML = '<div class="spinner"></div> AIê°€ PDF ë¶„ì„ ì¤‘... (1-2ë¶„ ì†Œìš”)';
            button.classList.add('loading');

            try {
                // PDFë¥¼ Base64ë¡œ ë³€í™˜
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64 = e.target.result.split(',')[1];

                    const response = await fetch('https://gogwan-backend-818506848351.asia-northeast3.run.app/api/pdf-to-ppt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            pdf_file: base64,
                            slide_style: 'professional'
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        pptData = data.ppt_file;
                        pptFilename = data.filename;

                        document.getElementById('slideCount').textContent = data.slide_count;
                        resultCard.classList.add('show');

                        // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
                        resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    } else {
                        alert('PPT ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }

                    button.innerHTML = originalHTML;
                    button.classList.remove('loading');
                };

                reader.readAsDataURL(selectedFile);

            } catch (error) {
                console.error('Error:', error);
                alert('PPT ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                button.innerHTML = originalHTML;
                button.classList.remove('loading');
            }
        });

        // PPT ë‹¤ìš´ë¡œë“œ
        function downloadPPT() {
            const link = document.createElement('a');
            link.href = 'data:application/vnd.openxmlformats-officedocument.presentationml.presentation;base64,' + pptData;
            link.download = pptFilename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
